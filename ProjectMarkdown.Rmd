---
title: "ISA 616 Class Project RMarkdown"
author: 
  - Yao Luo
date: "`r format(Sys.Date(), '%B %d, %Y')`"
bibliography: refs.bib
output: 
  html_document:
    code_folding: show
    df_print: paged
    number_sections: yes
    theme: cerulean
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      cache=TRUE,
                      out.width="100%",
                      warning=FALSE,
                      message=FALSE,
                      clean_cache=TRUE)
```
Outline
0 Introduction
    In this paper......
    An overview of the purpose of your analysis including details or references necessary.
    
1 Overview
1.1 Business Problem
1.2 Business Value Proposition

2 Data Description
◦the source
◦the variables with definitions or a link to a codebook
◦the number of observations in your data set
◦detail on missingness
◦a glimpse of your data if possible (e.g. head and tail)

3 Data Preprocessing
◦Feature generation
◦Imputation
◦Cleaning or merging of categories
◦Outlier removal
◦Anything that changes your data from the original form

4.Your Final Analysis in small pieces with annotation
5.Graphs to visualize different steps in your analysis
6.Clear discussion of why you made analysis choices
7.References to papers or citations you used to make decisions about the analysis


# Introduction

This article aims to provide a reproducible analytics workflow solving a hypothetical business problem using a predictive regression model on the UCI Wine data. A hypothetical business value proposition along with the full analytics solution will be provided. The important processes will also be documented. 

## Data Background

The datasets used is obtained from UCI Machine Learning Repository. The two datasets are related to red and white variants of the Portuguese "Vinho Verde" wine. For more details, consult: https://www.vinhoverde.pt/en/ 

## Business Problem

The business background of the project is to provide an analytics solution to the sales team in assisting with predicting wine quality / expert rating using only its chemical feature. The sales team would like to estimate on the wine quality before being in an expert so that they can potentially reduce cost by only have the expert rate the wine that's estimated to have higher quality. 

## Business Value Proposition

![](BusinessValueProposition.png)

# Data Overview

## Source of Data

Paulo Cortez, University of Minho, Guimarães, Portugal, http://www3.dsi.uminho.pt/pcortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis, Viticulture Commission of the Vinho Verde Region(CVRVV), Porto, Portugal, 2009

Download red wine dataset: <https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv>

Download white wine dataset: <https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-white.csv>

## Dataset Description

The datasets include 12 variables: 

Input variables: 

 * fixed.acidity
 * volatile.acidity
 * citric.acid
 * residual.sugar
 * chlorides
 * free.sulfur.dioxide
 * density
 * pH
 * sulphates
 * alcohol
 * quality

Output Variable:

 * wine.type (Score between 0 and 10)

For more information, read from this file: <https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality.names>

## A Glimps of Data {.tabset .tabset-fade .tabset-pills}

There are 12 columns available in both datasets. We can see that both datasets have the same attributes with the same data type, therefore it is reasonable for them to be combined.

```{r}
wineRed = read.csv("winequality-red.csv",sep = ";")
wineWhite = read.csv("winequality-white.csv",sep = ";")
```

### RedWine {-}

```{r}
head(wineRed)
```

### RedWine Structure{-}

```{r}
str(wineRed)
```

### WhiteWine {-}

```{r}
head(wineWhite)
```

### WhiteWine Structure{-}

```{r}
str(wineWhite)
```


# Data Preprocessing

Prepare the data by checking missing data, merging datasets, and creating functions necessary for later analysis. 

```{r}
Metadata<-function(df){
  library(DataExplorer)
  library(kableExtra)
  z<-introduce(df)
  z<-as.data.frame(t(z))
  colnames(z)<-c()
  knitr::kable(
    z,
    caption="Data Introduction"
  ) %>% kable_styling(bootstrap_options = c("striped", "hover"),
                      full_width = F,
                      font_size = 12,
                      position = "left")
  
}
```

## Missing Data

Based on the output below, we can see that there are no missing data present in both red and white wine datasets. 


```{r}
library(tidyverse)
wineRed %>% is.na() %>% colSums()
wineWhite %>% is.na() %>% colSums()
```

## Merging Datasets {.tabset .tabset-fade .tabset-pills}

The different wine types are transformed into dummies and stored in a categorical variable named wine.type. 

```{r}
# Create Dummies
wineRed$wine.type <- 1
wineWhite$wine.type <- 0

# Check Dimensions
dim(wineRed)
dim(wineWhite)

# Combine dataframes
wine = rbind(wineRed, wineWhite)

# Recode attribute as factor
wine$wine.type <- as.factor(wine$wine.type)

# Double check dimension
dim(wine)
```

### MetaData For Red Wine {-}

```{r echo=FALSE}
source("Functions.R")
Metadata(wineRed)
```

### MetaData For White Wine {-}

```{r echo=FALSE}
source("Functions.R")
Metadata(wineWhite)
```

### MetaData For Wine {-}

```{r echo=FALSE}
source("Functions.R")
Metadata(wine)
```


# Explanatory Data Analysis

To explore the dataset, we can take a look at a scatterplot for the response. We will use histograms for numerical variables, bar chart for categorical variables. Some  other summarized statistics were also shown down below. 

## Dataset Summary {.tabset .tabset-fade .tabset-pills}

From the scatterplot, we cannot see any obvious trend between any variables and response. 

From the histogram, we can see that most numeric variables are right skewed and unimodel which makes sense as these variables can't have negative values. PH and quality are both normally distributed. Total sulfur dioxide seems to be bimodel.

The barplot shows the distribution of red and white wine with more white wine in the data. 

### Head of Wine {-}

```{r}
head(wine)
```

### Scatterplot {-}

```{r}
## Scatterplot `quality` with all other continuous features
plot_scatterplot(split_columns(wine)$continuous, by = "quality", sampled_rows = 1000L)
```

### Histograms {-}

```{r}
library(DataExplorer)
plot_histogram(wine)
```

### Bar Plot {-}

```{r}
library(DataExplorer)
plot_bar(wine)
```

### Statistical Summary {-}

```{r}
summary(wine)
```

### Data Structure {-}

```{r}
str(wine)
```

## Correlation & Multicolinearity

### Correlation Plot

```{r}
library(DataExplorer)
plot_correlation(wine, type = "c")
```

### Strong Correlations

Based on the correlation plot above, some of the predictors have strong correlations: 

 * Between density and alcohol (-0.69)
 * Between free.sulfur.dioxide and total.sulfur.dioxide (0.72)

These strongly correlated variable could potentially lead to multicolinearity. 

# Modeling

## Spliting Data

To build the model, I will split it up the dataset into 75% of data for train datasets and 25% of data for test datasets.

```{r}
set.seed(13)
trainIndex = sample(1:nrow(wine), size = round(0.75*nrow(wine)), replace=FALSE)
train<-wine[trainIndex, ]
valid<-wine[-trainIndex, ]
nrow(train)
nrow(valid)
```

## Stepwise Model

We will feed all predictors to create a full model, and then run a stepwise model from both directions. I have eliminated the summary for full model and show the summary for the final stepwise model down below. 

```{r}
library(MASS)
# Fit the full model 
full <- lm(quality ~., data = train)
# Stepwise regression model
step <- stepAIC(full, direction = "both", trace = FALSE)
summary(step)
```

# Results and Performance

## Model Interpretation

## Prediciton using Validaiton data

```{r}
p.valid<-predict(step, newdata=valid)
head(p.valid)
```

## Model Evaluation

```{r}
library(caret)
RMSE(p.valid, valid$quality)
R2(p.valid, valid$quality)
```

# Conclusion





## One number

```{r pressure,results='asis'}
pressure
paste("The mean pressure is:", round(mean(pressure$pressure),3), "mm")
```

## A table


```{r pressureTable}
library(knitr)
kable(head(pressure), format="pipe", digit=3)
kable(tail(pressure), format="pipe", digit=3)
```


# Including Plots {.tabset .tabset-fade .tabset-pills}

You can also embed plots, for example:

## Plotly {-}

```{r pressurePlot, echo=FALSE}
library(plotly)
plot_ly(pressure, x=~temperature, y=~pressure, type="scatter",mode="lines+markers")
```

## Map {-}

```{r fsbLoc, echo=FALSE}
library(dplyr)
library(leaflet)
leaflet()%>%addTiles%>%
  setView(-84.7298,39.5113,zoom=17)%>%
  addPopups(-84.7298,39.5113,"we are here")
```

For more details on organizing with tabset go here <https://bookdown.org/yihui/rmarkdown-cookbook/html-tabs.html>.

# Equations

You can include both inline and offset equations.

## Inline equations

You can include inline equations like $y = nx + b$, you can also do more complicated inline equations such as $\hat{y} = \hat{\beta} + \hat{\beta_1}x$

## Offset equations

\begin{euqation}
y=mx+b
\tag{1}
\end{euqation}

# References
